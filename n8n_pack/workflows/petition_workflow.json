{
  "name": "Petition Funnel Workflow",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "/webhook/petition-signed"
      },
      "id": "petition-webhook",
      "name": "Petition Signed Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [100, 300],
      "webhookId": "petition-signed"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "url": "={{ $vars.AGENT_BASE_URL }}/agents/petition-funnel-optimizer",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpBearerAuth",
        "sendBody": true,
        "contentType": "json",
        "jsonBody": "={{ JSON.stringify({\n  action: 'process_signature',\n  signature_data: $json,\n  generate_certificate: true\n}) }}"
      },
      "id": "process-signature",
      "name": "Process Signature",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [300, 300]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "url": "={{ $vars.AGENT_BASE_URL }}/agents/petition-legal-reviewer",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpBearerAuth",
        "sendBody": true,
        "contentType": "json",
        "jsonBody": "={{ JSON.stringify({\n  signature_data: $json,\n  verify_consent: true,\n  check_compliance: true\n}) }}"
      },
      "id": "legal-review",
      "name": "üìã Legal Review",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [300, 450]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $('legal-review').item.json.status }}",
              "operation": "equal",
              "value2": "ok"
            }
          ]
        }
      },
      "id": "compliance-gate",
      "name": "‚úÖ Compliance Gate",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [500, 375]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "url": "={{ $vars.AGENT_BASE_URL }}/agents/certification-identity",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpBearerAuth",
        "sendBody": true,
        "contentType": "json",
        "jsonBody": "={{ JSON.stringify({\n  signer_info: $('process-signature').item.json,\n  petition_id: $json.petition_id || 'main-petition',\n  mint_certificate: true\n}) }}"
      },
      "id": "mint-certificate",
      "name": "üèÜ Mint Certificate",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [700, 300]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "url": "={{ $vars.AGENT_BASE_URL }}/agents/impact-analytics",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpBearerAuth",
        "sendBody": true,
        "contentType": "json",
        "jsonBody": "={{ JSON.stringify({\n  event_type: 'petition_signature',\n  event_data: {\n    certificate_id: $('mint-certificate').item.json.certificate_id,\n    signature_timestamp: new Date().toISOString(),\n    source: $json.utm_source || 'direct'\n  }\n}) }}"
      },
      "id": "track-analytics",
      "name": "üìä Track Analytics",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [900, 300]
    }
  ],
  "connections": {
    "Petition Signed Webhook": {
      "main": [
        [
          {
            "node": "Process Signature",
            "type": "main",
            "index": 0
          },
          {
            "node": "üìã Legal Review",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Signature": {
      "main": [
        [
          {
            "node": "‚úÖ Compliance Gate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìã Legal Review": {
      "main": [
        [
          {
            "node": "‚úÖ Compliance Gate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚úÖ Compliance Gate": {
      "main": [
        [
          {
            "node": "üèÜ Mint Certificate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üèÜ Mint Certificate": {
      "main": [
        [
          {
            "node": "üìä Track Analytics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {},
  "versionId": "1.0.0",
  "id": "petition-workflow"
}
